<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Модеры | VimeStats</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/common.css" rel="stylesheet">
    <link href="css/responsive.css" rel="stylesheet">
    <link rel="stylesheet" href="css/settings.css">
    <style>
        body {
            background: linear-gradient(135deg, #ffffff 0%, #e6f3ff 100%);
            min-height: 100vh;
        }
        .moder-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        .moder-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
        }
        @media (max-width: 768px) {
            .container {
                margin: 60px auto 0;
                padding: 10px;
            }
            .navbar .container-fluid {
                padding: 0 10px;
            }
            .navbar-brand {
                font-size: 1rem;
                padding-left: 10px;
            }
            #quick-search {
                width: 260px;
            }
            #moders-container {
                grid-template-columns: repeat(1, 1fr) !important;
            }
        }
    </style>
</head>
<body>
    <div id="navbar-placeholder"></div>

    <div style="height:70px;"></div>
    <div class="container">
        <div id="moders-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
            <!-- Модераторы будут добавлены сюда динамически -->
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/ranks.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/search.js"></script>
    <script src="js/navbar.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/settings.js"></script>

    <script>
        // Функция для получения данных о модераторах
        async function fetchModerators() {
            try {
                const response = await fetch('https://api.vimeworld.com/online/staff');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const moderators = await response.json();
                return moderators;
            } catch (error) {
                console.error('Error fetching moderators:', error);
                return [];
            }
        }

        // Функция для создания карточки модератора
        function createModeratorCard(moderator) {
            const card = document.createElement('div');
            card.className = 'moder-card';

            const rankInfo = ranksData[moderator.rank] || { name: moderator.rank, colors: [] };
            let rankStyle = '';
            if (rankInfo.colors.length > 0) {
                if (rankInfo.colors.length === 1) {
                    rankStyle = `color: #${rankInfo.colors[0]};`;
                } else {
                    const gradient = `background: linear-gradient(to right, ${rankInfo.colors.map(color => `#${color}`).join(', ')});
                                    -webkit-background-clip: text;
                                    -webkit-text-fill-color: transparent;`;
                    rankStyle = gradient;
                }
            }

            card.innerHTML = `
                <div style="position: relative;">
                    <img src="https://skin.vimeworld.com/head/${moderator.username}.png" 
                         alt="${moderator.username}" 
                         style="width: 48px; height: 48px; border-radius: 8px;">
                    <div class="online-status ${moderator.online ? 'online' : 'offline'}"
                         style="position: absolute; bottom: -2px; right: -2px;"></div>
                </div>
                <div style="flex-grow: 1;">
                    <div style="font-family: 'VimeArtBold', sans-serif; font-size: 1.1rem; ${rankStyle}">
                        ${moderator.username}
                    </div>
                    <div style="font-size: 0.9rem; ${rankStyle}">
                        ${rankInfo.name}
                    </div>
                </div>
            `;

            card.addEventListener('click', () => {
                window.location.href = `player.html?username=${encodeURIComponent(moderator.username)}`;
            });

            return card;
        }

        // Функция для отображения модераторов
        async function displayModerators() {
            const container = document.getElementById('moders-container');
            const moderators = await fetchModerators();
            
            // Очищаем контейнер
            container.innerHTML = '';
            
            // Сортируем модераторов по рангу и имени
            moderators.sort((a, b) => {
                // Сначала сортируем по рангу
                const rankOrder = {
                    'ADMIN': 1,
                    'CHIEF': 2,
                    'WARDEN': 3,
                    'MODER': 4,
                    'HELPER': 5
                };
                
                const rankDiff = (rankOrder[a.rank] || 99) - (rankOrder[b.rank] || 99);
                if (rankDiff !== 0) return rankDiff;
                
                // Затем по имени
                return a.username.localeCompare(b.username);
            });

            // Добавляем карточки модераторов
            moderators.forEach(moderator => {
                const card = createModeratorCard(moderator);
                container.appendChild(card);
            });
        }

        // Загружаем модераторов при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            displayModerators();
            // Обновляем список каждые 30 секунд
            setInterval(displayModerators, 30000);
        });
    </script>

    <!-- Кнопка настроек -->
    <div id="settings-btn">
        <div class="gear">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="gear-inner"></div>
        </div>
    </div>

    <!-- Меню настроек -->
    <div id="settings-menu">
        <div class="settings-item">
            <span class="settings-label">Отключить кастомный шрифт</span>
            <div class="settings-toggle" id="font-toggle"></div>
        </div>
    </div>
</body>
</html>